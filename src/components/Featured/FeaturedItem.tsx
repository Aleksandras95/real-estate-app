import { Link } from "react-router-dom";
import { supabase } from "../../lib/supabaseClient";
import { useEffect, useState } from "react";

interface Props {
  item: Item;
  onUnlike?: (id: string) => void;
}

const FeaturedItem = ({ item, onUnlike }: Props) => {
  const [isFavorite, setIsFavorite] = useState(false);

  useEffect(() => {
    const checkFavorite = async () => {
      const {
        data: { user },
      } = await supabase.auth.getUser();

      if (!user) return;

      const { data, error } = await supabase
        .from("favorites")
        .select("*")
        .eq("property_id", item.id)
        .eq("user_id", user.id);

      if (data && data.length > 0) setIsFavorite(true);
    };

    checkFavorite();
  }, [item.id]);

  const toggleFavorite = async () => {
    const {
      data: { user },
    } = await supabase.auth.getUser();

    if (!user) return alert("You need to be logged in");

    if (isFavorite) {
      const { error } = await supabase
        .from("favorites")
        .delete()
        .eq("property_id", item.id)
        .eq("user_id", user.id);

      if (!error) {
        setIsFavorite(false);
        if (onUnlike) {
          onUnlike(item.id);
        }
      }
    } else {
      const { error } = await supabase.from("favorites").insert({
        user_id: user.id,
        property_id: item.id,
      });

      if (!error) {
        setIsFavorite(true);
      }
    }
  };

  return (
    <Link
      to={`/property/${item.id}`}
      className="block bg-white rounded-2xl border p-5 h-full"
    >
      <img
        src={item.cover_image}
        alt={item.title}
        className="w-full h-66.5 object-cover rounded-2xl mb-4"
      />
      <h3 className="font-bold text-2xl mb-2.5">{item.title}</h3>
      <p className="text-black text-xl mb-2.5">${item.price}</p>
      <p className="text-base text-[#A4A6AC] mb-4">{item.intro}</p>
      <div className="flex items-center gap-4">
        <div className="flex items-center gap-2.5">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
          >
            <path
              d="M23 12.25V10.25C23 8.72996 22.02 7.74999 20.5 7.74999H9C7.47998 7.74999 6.50002 8.73 6.50002 10.25V12.2343L1.635 12.245H0.999984V3.76496C0.999984 3.51497 0.819984 3.28997 0.574969 3.25496C0.264984 3.20996 0 3.44996 0 3.74996V20.235C0 20.4849 0.18 20.7099 0.425016 20.745C0.735 20.79 1.00003 20.55 1.00003 20.25V17.25H23V20.235C23 20.4849 23.18 20.7099 23.425 20.745C23.735 20.79 24 20.55 24 20.25V13.25C24 12.57 23.68 12.255 23 12.25ZM7.5 10.25C7.5 8.94497 8.43998 8.74997 9 8.74997H20.5C21.06 8.74997 22 8.94497 22 10.25V12.25H7.5V10.25ZM23 16.25H0.999984V13.25H23V16.25Z"
              fill="#0F1015"
            />
            <path
              d="M3.77344 6.67969C2.23955 6.67969 0.996094 7.92314 0.996094 9.45703C0.996094 10.9909 2.23955 12.2344 3.77344 12.2344C5.30733 12.2344 6.55078 10.9909 6.55078 9.45703C6.55078 7.92314 5.30733 6.67969 3.77344 6.67969ZM3.77344 11.3438C2.73145 11.3438 1.88672 10.499 1.88672 9.45703C1.88672 8.41505 2.73145 7.57031 3.77344 7.57031C4.81542 7.57031 5.66016 8.41505 5.66016 9.45703C5.66016 10.499 4.81547 11.3438 3.77344 11.3438Z"
              fill="#0F1015"
            />
          </svg>
          <p className="text-base">{item.bedrooms}</p>
        </div>
        <div className="flex items-center gap-2.5">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
          >
            <g clip-path="url(#clip0_3334_4539)">
              <path
                d="M22.8 12.7998H22.4V4.3998C22.4 2.39979 20.8 0.799805 18.8 0.799805C17.0295 0.799805 15.7562 2.11259 15.6137 4.0361C14.6842 4.21179 14 5.01232 14 5.99979C14 6.23979 14.16 6.39977 14.4 6.39977H17.6C17.84 6.39977 18 6.23979 18 5.99979C18 5.02324 17.3309 4.22937 16.4172 4.04196C16.5367 2.7709 17.3001 1.59977 18.8 1.59977C20.36 1.59977 21.6 2.83976 21.6 4.39976V12.7998H9.56133C9.38039 11.8772 8.58267 11.1998 7.60003 11.1998C7.20005 10.7198 6.64003 10.3998 6.00005 10.3998C5.24006 10.3998 4.56005 10.8398 4.24003 11.4798C3.92002 11.3198 3.56002 11.1998 3.20002 11.1998C2.21738 11.1998 1.41966 11.8772 1.23872 12.7998H1.2C0.519984 12.7998 0 13.3197 0 13.9998C0 14.6798 0.519984 15.1998 1.2 15.1998H1.6807L2.76 19.4798C3.08002 20.7198 4.2 21.5998 5.48002 21.5998H5.80003L5.28005 22.6398C5.16005 22.8398 5.24006 23.0798 5.44003 23.1598C5.48002 23.1998 5.56003 23.1998 5.60002 23.1998C5.76 23.1998 5.88 23.1198 5.96002 22.9998L6.66 21.5998H17.76L18.44 22.9598C18.52 23.1198 18.64 23.1998 18.8 23.1998C18.88 23.1998 18.92 23.1998 18.96 23.1198C19.12 23.0397 19.2 22.7997 19.12 22.5998L18.6189 21.5976C19.8573 21.5537 20.9283 20.6887 21.24 19.5198L22.3294 15.1998H22.8C23.48 15.1998 24 14.6798 24 13.9998C24 13.3198 23.48 12.7998 22.8 12.7998ZM17.16 5.59981H14.88C15.04 5.11981 15.52 4.79979 16.04 4.79979C16.56 4.79979 17 5.11981 17.16 5.59981ZM3.20002 11.9998C3.56002 11.9998 3.88003 12.1598 4.16002 12.4398C4.24003 12.5598 4.40002 12.5998 4.56 12.5598C4.71998 12.5198 4.8 12.3998 4.83998 12.2398C4.95998 11.6398 5.43998 11.1998 6.03998 11.1998C6.48 11.1998 6.87998 11.3998 7.08 11.7998C7.16002 11.9598 7.35998 12.0398 7.52002 11.9998C7.56 11.9998 7.60003 11.9998 7.64002 11.9998C8.16 11.9998 8.60002 12.3198 8.76 12.7998H2.07998C2.24002 12.3198 2.67998 11.9998 3.20002 11.9998ZM20.52 19.2798C20.28 20.1598 19.48 20.7998 18.56 20.7998H5.52C4.59998 20.7998 3.80002 20.1598 3.56002 19.2798L2.52 15.1998H21.48L20.52 19.2798ZM22.8 14.3998H22H2.00002H1.2C0.96 14.3998 0.800016 14.2398 0.800016 13.9998C0.800016 13.7598 0.96 13.5998 1.2 13.5998H1.59998H9.19997H22.8C23.04 13.5998 23.2 13.7598 23.2 13.9998C23.2 14.2398 23.04 14.3998 22.8 14.3998Z"
                fill="#0F1015"
              />
              <path
                d="M14.4 8.19969C14.64 8.19969 14.8 8.03971 14.8 7.79971V7.59969C14.8 7.35969 14.64 7.19971 14.4 7.19971C14.16 7.19971 14 7.35969 14 7.59969V7.79971C14 8.03971 14.16 8.19969 14.4 8.19969Z"
                fill="#0F1015"
              />
              <path
                d="M14.4 10.0398C14.64 10.0398 14.8 9.83977 14.8 9.63981V9.19979C14.8 8.95979 14.64 8.7998 14.4 8.7998C14.16 8.7998 14 8.95979 14 9.19979V9.63981C14 9.87976 14.16 10.0398 14.4 10.0398Z"
                fill="#0F1015"
              />
              <path
                d="M14.4 11.5996C14.64 11.5996 14.8 11.4396 14.8 11.1996V10.9996C14.8 10.7596 14.64 10.5996 14.4 10.5996C14.16 10.5996 14 10.7596 14 10.9996V11.1996C14 11.4396 14.16 11.5996 14.4 11.5996Z"
                fill="#0F1015"
              />
              <path
                d="M16.0001 8.19969C16.2401 8.19969 16.4001 8.03971 16.4001 7.79971V7.59969C16.4001 7.35969 16.2401 7.19971 16.0001 7.19971C15.7601 7.19971 15.6001 7.35969 15.6001 7.59969V7.79971C15.6001 8.03971 15.7601 8.19969 16.0001 8.19969Z"
                fill="#0F1015"
              />
              <path
                d="M15.6001 9.6398C15.6001 9.8798 15.7601 10.0398 16.0001 10.0398C16.2401 10.0398 16.4001 9.83977 16.4001 9.6398V9.19979C16.4001 8.95979 16.2401 8.7998 16.0001 8.7998C15.7601 8.7998 15.6001 8.95979 15.6001 9.19979V9.6398Z"
                fill="#0F1015"
              />
              <path
                d="M15.6001 11.1996C15.6001 11.4396 15.7601 11.5996 16.0001 11.5996C16.2401 11.5996 16.4001 11.4396 16.4001 11.1996V10.9996C16.4001 10.7596 16.2401 10.5996 16.0001 10.5996C15.7601 10.5996 15.6001 10.7596 15.6001 10.9996V11.1996Z"
                fill="#0F1015"
              />
              <path
                d="M17.5999 8.19969C17.8399 8.19969 17.9999 8.03971 17.9999 7.79971V7.59969C17.9999 7.35969 17.8399 7.19971 17.5999 7.19971C17.3599 7.19971 17.2 7.35969 17.2 7.59969V7.79971C17.1999 8.03971 17.3599 8.19969 17.5999 8.19969Z"
                fill="#0F1015"
              />
              <path
                d="M17.2 9.6398C17.2 9.8798 17.3599 10.0398 17.5999 10.0398C17.8399 10.0398 18 9.83982 18 9.6398V9.19979C18 8.95979 17.84 8.7998 17.6 8.7998C17.36 8.7998 17.2 8.95979 17.2 9.19979V9.6398H17.2Z"
                fill="#0F1015"
              />
              <path
                d="M17.2 11.1996C17.2 11.4396 17.3599 11.5996 17.5999 11.5996C17.8399 11.5996 17.9999 11.4396 17.9999 11.1996V10.9996C17.9999 10.7596 17.8399 10.5996 17.5999 10.5996C17.3599 10.5996 17.2 10.7596 17.2 10.9996V11.1996Z"
                fill="#0F1015"
              />
            </g>
            <defs>
              <clipPath id="clip0_3334_4539">
                <rect width="24" height="24" fill="white" />
              </clipPath>
            </defs>
          </svg>
          <p className="text-base">{item.bathrooms}</p>
        </div>
      </div>
      <div className="bg-[#A4A6AC33] w-full h-[1px] my-4"></div>
      <div className="flex items-center justify-between">
        <div className="flex items-center gap-2.5">
          <p className="text-base">Alexa Mate</p>
        </div>
        <div className="flex items-center gap-2.5">
          <div
            className="w-8.5 h-8.5 border rounded-[5px] flex items-center justify-center cursor-pointer heart"
            onClick={(e) => {
              e.preventDefault();
              toggleFavorite();
            }}
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="18"
              viewBox="0 0 18 18"
              fill="none"
            >
              <path
                d="M9.57378 3.52672L9 4.14317L8.42621 3.52672C6.84175 1.82443 4.27282 1.82443 2.68835 3.52671C1.10388 5.229 1.10388 7.98895 2.68835 9.69124L7.85243 15.2393C8.48621 15.9202 9.51379 15.9202 10.1476 15.2393L15.3116 9.69124C16.8961 7.98895 16.8961 5.229 15.3116 3.52672C13.7272 1.82443 11.1583 1.82443 9.57378 3.52672Z"
                stroke="#0F1015"
                stroke-width="1.5"
                stroke-linejoin="round"
                className={`${isFavorite ? "fill-red-500 stroke-red-500" : ""}`}
              />
            </svg>
          </div>
          <div className="w-8.5 h-8.5 border border-solid border-[#A4A6AC33] rounded-[5px] flex items-center justify-center cursor-pointer">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="18"
              viewBox="0 0 18 18"
              fill="none"
            >
              <g clip-path="url(#clip0_5158_159)">
                <path
                  d="M6.47338 7.82581C6.04242 6.96555 5.15267 6.375 4.125 6.375C2.67525 6.375 1.5 7.55025 1.5 9C1.5 10.4497 2.67525 11.625 4.125 11.625C5.15267 11.625 6.04242 11.0344 6.47338 10.1742M6.47338 7.82581C6.65039 8.17912 6.75 8.57793 6.75 9C6.75 9.42207 6.65039 9.82088 6.47338 10.1742M6.47338 7.82581L11.5266 5.29919M6.47338 10.1742L11.5266 12.7008M11.5266 5.29919C11.9576 6.15945 12.8473 6.75 13.875 6.75C15.3247 6.75 16.5 5.57475 16.5 4.125C16.5 2.67525 15.3247 1.5 13.875 1.5C12.4253 1.5 11.25 2.67525 11.25 4.125C11.25 4.54707 11.3496 4.94588 11.5266 5.29919ZM11.5266 12.7008C11.3496 13.0541 11.25 13.4529 11.25 13.875C11.25 15.3247 12.4253 16.5 13.875 16.5C15.3247 16.5 16.5 15.3247 16.5 13.875C16.5 12.4253 15.3247 11.25 13.875 11.25C12.8473 11.25 11.9576 11.8406 11.5266 12.7008Z"
                  stroke="#0F1015"
                  stroke-width="1.5"
                  stroke-linecap="round"
                />
              </g>
              <defs>
                <clipPath id="clip0_5158_159">
                  <rect width="18" height="18" fill="white" />
                </clipPath>
              </defs>
            </svg>
          </div>
        </div>
      </div>
    </Link>
  );
};

export default FeaturedItem;
